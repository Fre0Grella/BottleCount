<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <title>BottleCount</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçæ</text></svg>">
  <style>
    :root {
      --bg:       #0f0f1a;
      --surface:  #1a1a2e;
      --surface2: #252538;
      --border:   #2d2d44;
      --border2:  #3d3d5c;
      --text:     #e2e8f0;
      --muted:    #94a3b8;
      --indigo:   #6366f1;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: system-ui, -apple-system, sans-serif;
      min-height: 100dvh;
      font-size: 15px;
    }

    /* ‚îÄ‚îÄ Nav ‚îÄ‚îÄ */
    .nav {
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 50;
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 0 12px;
      height: 52px;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }
    .nav::-webkit-scrollbar { display: none; }
    .nav-brand { font-size: 1.1rem; font-weight: 800; white-space: nowrap; margin-right: 8px; flex-shrink: 0; }
    .nav-link {
      padding: 6px 12px;
      border-radius: 8px;
      font-weight: 600;
      color: var(--muted);
      white-space: nowrap;
      flex-shrink: 0;
      font-size: 0.85rem;
      transition: background .15s, color .15s;
      text-decoration: none;
    }
    .nav-link:hover, .nav-link.active {
      background: var(--border);
      color: var(--text);
    }

    /* ‚îÄ‚îÄ Cards ‚îÄ‚îÄ */
    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 14px;
    }

    /* ‚îÄ‚îÄ Form controls ‚Äî large touch targets ‚îÄ‚îÄ */
    input[type=number],
    input[type=text],
    select {
      background: var(--surface2);
      border: 1px solid var(--border2);
      border-radius: 8px;
      padding: 8px 10px;
      color: var(--text);
      width: 100%;
      font-size: 15px;
      min-height: 40px;
    }
    input[type=number]:focus,
    input[type=text]:focus,
    select:focus { outline: 2px solid var(--indigo); outline-offset: 1px; }
    input[type=range] { accent-color: var(--indigo); width: 100%; }

    /* ‚îÄ‚îÄ Buttons ‚îÄ‚îÄ */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      border-radius: 10px;
      padding: 10px 18px;
      font-weight: 700;
      font-size: 0.9rem;
      cursor: pointer;
      transition: filter .15s, transform .1s;
      border: none;
      white-space: nowrap;
      min-height: 42px;
    }
    .btn:active { transform: scale(.97); }
    .btn-primary { background: var(--indigo); color: #fff; }
    .btn-primary:hover { filter: brightness(1.15); }
    .btn-success { background: #22c55e; color: #fff; }
    .btn-success:hover { filter: brightness(1.1); }
    .btn-orange  { background: #f97316; color: #fff; text-decoration: none; }
    .btn-orange:hover  { filter: brightness(1.1); }
    .btn-sm { padding: 6px 12px; font-size: 0.8rem; min-height: 34px; border-radius: 8px; }
    .btn-danger {
      background: #ef4444;
      color: #fff;
      border-radius: 8px;
      padding: 6px 10px;
      cursor: pointer;
      font-size: 0.8rem;
      font-weight: 700;
      border: none;
      min-height: 34px;
    }
    .btn-danger:active { transform: scale(.97); }

    /* ‚îÄ‚îÄ Status indicators ‚îÄ‚îÄ */
    .ok  { color: #4ade80; font-weight: 700; }
    .err { color: #f87171; font-weight: 700; }

    /* ‚îÄ‚îÄ Mobile-friendly table replacement: stacked rows ‚îÄ‚îÄ */
    .mob-table { width: 100%; }
    .mob-row {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 12px;
      border-bottom: 1px solid var(--border);
      font-size: 0.875rem;
    }
    .mob-row:last-child { border-bottom: none; }
    .mob-row:hover { background: rgba(255,255,255,.03); }
    .mob-name { flex: 1; min-width: 0; }
    .mob-name-text { font-weight: 500; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .mob-name-sub  { font-size: 0.75rem; color: var(--muted); margin-top: 1px; }
    .mob-right { text-align: right; white-space: nowrap; font-size: 0.8rem; }
    .mob-right .price-min { color: #4ade80; }
    .mob-right .price-max { color: #f87171; }

    /* For desktop: show as real table */
    @media (min-width: 640px) {
      table.real-table { width: 100%; border-collapse: collapse; }
      table.real-table th {
        background: var(--surface2);
        padding: 8px 10px;
        text-align: left;
        font-size: .75rem;
        color: var(--muted);
        text-transform: uppercase;
        letter-spacing: .05em;
      }
      table.real-table td {
        padding: 8px 10px;
        border-bottom: 1px solid var(--border);
        font-size: .875rem;
      }
      table.real-table tr:hover td { background: rgba(255,255,255,.02); }
    }

    /* ‚îÄ‚îÄ Type badges ‚îÄ‚îÄ */
    .type-badge {
      display: inline-block;
      font-size: .68rem;
      font-weight: 700;
      padding: 2px 7px;
      border-radius: 20px;
      letter-spacing: .04em;
      text-transform: uppercase;
      white-space: nowrap;
      flex-shrink: 0;
    }
    .type-spirit { background:#7c2d12; color:#fb923c; border:1px solid #c2410c; }
    .type-beer   { background:#713f12; color:#fde047; border:1px solid #a16207; }
    .type-wine   { background:#4a044e; color:#e879f9; border:1px solid #a21caf; }
    .type-mixer  { background:#0c4a6e; color:#38bdf8; border:1px solid #0369a1; }
    .type-snack  { background:#14532d; color:#86efac; border:1px solid #16a34a; }
    .type-extra  { background:#1e293b; color:#94a3b8; border:1px solid #475569; }

    /* ‚îÄ‚îÄ Collapsible sections ‚îÄ‚îÄ */
    .collapsible-btn {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: none;
      border: none;
      color: var(--text);
      cursor: pointer;
      padding: 14px 16px;
      font-size: 1rem;
      font-weight: 700;
      text-align: left;
    }
    .collapsible-btn .chevron {
      transition: transform .2s;
      color: var(--muted);
      flex-shrink: 0;
    }
    .collapsible-btn.open .chevron { transform: rotate(180deg); }
    .collapsible-body { overflow: hidden; }
    .collapsible-body.closed { display: none; }

    /* ‚îÄ‚îÄ Section label ‚îÄ‚îÄ */
    .section-label {
      font-size: 0.7rem;
      font-weight: 700;
      letter-spacing: .08em;
      text-transform: uppercase;
      color: var(--muted);
      padding: 0 4px;
      margin-bottom: 6px;
    }

    /* ‚îÄ‚îÄ Grid helpers ‚îÄ‚îÄ */
    .grid-2 {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }
    @media (min-width: 640px) {
      .grid-2 { grid-template-columns: 1fr 1fr; }
    }
    .grid-kpi {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    @media (min-width: 480px) {
      .grid-kpi { grid-template-columns: repeat(3, 1fr); }
    }
    @media (min-width: 720px) {
      .grid-kpi { grid-template-columns: repeat(5, 1fr); }
    }
  </style>
</head>
<body>
  <nav style="background:#1e1e2e;border-bottom:1px solid #2d2d44" class="px-4 py-3 flex items-center justify-between sm:gap-2">

  <!-- Logo -->
  <span class="text-xl font-bold sm:mr-4">
    üçæ <span class="hidden sm:inline">BottleCount</span>
  </span>

  <!-- Links -->
  <div class="flex items-center gap-4 sm:gap-2">
    <a href="/"        class="nav-link {% if request.path=='/' %}active{% endif %}">üìä <span class="hidden sm:inline">Dashboard</span></a>
    <a href="/menu"    class="nav-link {% if request.path=='/menu' %}active{% endif %}">üçπ <span class="hidden sm:inline">Drink Menu</span></a>
    <a href="/catalog" class="nav-link {% if request.path=='/catalog' %}active{% endif %}">üìö <span class="hidden sm:inline">Catalog</span></a>
  </div>

  <div class="flex items-center gap-3 sm:gap-2">
    {% if session.get('name') %}
    <!-- Authenticated: avatar + name + logout -->
    <img src="{{ session.picture }}" class="rounded-full w-7 h-7">
    <span class="text-sm text-slate-400 hidden sm:inline">{{ session.name }}</span>
    <a href="/logout" class="nav-link text-sm flex items-center gap-1">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none"
      viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round"
      d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h6a2 2 0 012 2v1"/>
    </svg>
    <span class="hidden sm:inline">Sign out</span>
  </a>
  {% else %}
    <!-- Not authenticated: sign in button -->
    <a href="/login" class="nav-link flex items-center gap-2 text-sm">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24">
        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z"/>
        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
      </svg>
      <span class="hidden sm:inline">Sign in with Google</span>
    </a>
    {% endif %}
  </div>


</nav>


  <main style="padding: 12px; max-width: 900px; margin: 0 auto;">
    {% block content %}{% endblock %}
    </main>

  <script>
    async function apiPost(url, data) {
      const r    = await fetch(url, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
      });
      const json = await r.json();
      if (r.status === 401) {
        showAuthError(json.message, json.login_url);
        return { ok: false };
      }
      return json;
    }

    async function apiDelete(url) {
      const r    = await fetch(url, { method: 'DELETE' });
      const json = await r.json();
      if (r.status === 401) {
        showAuthError(json.message, json.login_url);
        return { ok: false };
      }
      return json;
    }

    function showAuthError(message, loginUrl) {
      document.getElementById('auth-toast')?.remove();
      const toast = document.createElement('div');
      toast.id = 'auth-toast';
      toast.innerHTML = `
        <div style="
          position:fixed; bottom:24px; left:50%; transform:translateX(-50%);
          background:#1e1e2e; border:1px solid #ef4444; border-radius:12px;
          padding:16px 24px; display:flex; align-items:center; gap:12px;
          z-index:9999; box-shadow:0 8px 32px rgba(0,0,0,.4); min-width:300px;
        ">
          <span style="font-size:1.4rem">üîí</span>
          <div>
            <p style="color:#f87171; font-weight:700; margin:0">Not signed in</p>
            <p style="color:#94a3b8; font-size:.85rem; margin:4px 0 0">${message}</p>
          </div>
          <a href="${loginUrl}" style="
            margin-left:auto; background:#6366f1; color:#fff;
            padding:6px 14px; border-radius:8px; font-weight:600;
            text-decoration:none; font-size:.85rem; white-space:nowrap;
          ">Sign in ‚Üí</a>
          <button onclick="this.closest('#auth-toast').remove()"
            style="background:none;border:none;color:#94a3b8;cursor:pointer;font-size:1.1rem">‚úï</button>
        </div>
      `;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 6000);
    }

    function toggleSection(btnEl) {
      btnEl.classList.toggle('open');
      const body = btnEl.nextElementSibling;
      body.classList.toggle('closed');
    }
  </script>

  {% block scripts %}{% endblock %}
</body>

</html>
